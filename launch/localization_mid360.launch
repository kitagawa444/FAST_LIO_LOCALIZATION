<launch>
  <!-- Launch file for Livox MID360 LiDAR -->

  <arg name="map" default="" />

  <arg name="headless" default="false" />

  <arg name="find_initial_pose" default="false" />

  <arg name="livox_driver" default="true" />

  <arg name="frame_offset_x" default="0.0"/>
  <arg name="frame_offset_y" default="0.0"/>
  <arg name="frame_offset_z" default="0.0"/>
  <arg name="frame_offset_roll" default="0.0"/>
  <arg name="frame_offset_pitch" default="0.0"/>
  <arg name="frame_offset_yaw" default="0.0"/>

  <!-- fast lio for odometry -->
  <include file="$(find fast_lio)/launch/mapping_mid360.launch" >
    <arg name="rviz" value="false" />
    <arg name="livox_driver" value="$(arg livox_driver)" />
  </include>

  <group unless="$(arg find_initial_pose)">
    <!-- loalization-->
    <node pkg="fast_lio_localization" type="global_localization.py" name="global_localization" output="screen">
      <param name="initial_frame_offset/x" value="$(arg frame_offset_x)"/>
      <param name="initial_frame_offset/y" value="$(arg frame_offset_y)"/>
      <param name="initial_frame_offset/z" value="$(arg frame_offset_z)"/>
      <param name="initial_frame_offset/roll" value="$(arg frame_offset_roll)"/>
      <param name="initial_frame_offset/pitch" value="$(arg frame_offset_pitch)"/>
      <param name="initial_frame_offset/yaw" value="$(arg frame_offset_yaw)"/>
      <param name="headless" value="$(arg headless)"/>
    </node>
  </group>

  <!-- global map-->
  <node pkg="pcl_ros" type="pcd_to_pointcloud" name="map_publishe" output="screen" args="$(arg map) 5 _frame_id:=/map cloud_pcd:=/map" />

  <!-- rviz -->
  <node launch-prefix="nice" pkg="rviz" type="rviz" name="rviz" args="-d $(find fast_lio_localization)/rviz_cfg/localization.rviz" unless="$(arg headless)"/>


</launch>
